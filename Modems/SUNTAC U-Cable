!******************************************************!	SUNTAC  U-Cable!	06/20/2002  Rev.Ａ!	Written by  Toshihiro Yuasa!!  'mlts' resource info for this modem:!    byte 1 == 01 -> modem HAS builtin reliability protocols!    byte 2 == 00 -> reserved by Apple!    byte 3 == 35 -> max hex chars in varstr 7 (53 dec)!    byte 4 == 35 -> max hex chars in varstr 8!    byte 5 == 35 -> max hex chars in varstr 9!	!********************************************************@ORIGINATE@ANSWER!******************************************! set up the modem - label range is 1-10!!******************************************! Mac talks to the modem at 115,200 bps.  pause 20serreset 115200, 0, 8, 1!------------------------! reset the serial port!------------------------HSReset 0 0 0 0 0 0!------------------! Reset the Modem　!------------------pause 10DTRSetpause 5DTRClearpause 5DTRSetpause 10flushjump 1!settries 0@LABEL 1pause 10matchclrmatchstr 1 3 "OK\13\10"write "ATZ&D0\13"matchread 30inctriesiftries 2 81!!!@LABEL 3!--------------------------------------! Set communication mode and speed.!---------------------------------------matchclrmatchstr 1 4 "OK\13\10"write "AT\13"matchread 30jump 81!!!@LABEL 4!-----------------------------------------! Modem responding & configured.! determine if reliable link is requested.!-----------------------------------------! if modem mnp10 link requested (var 4 == 2) then jump label 5ifstr 4 5 "2"!! if modem v42 link requested (var 4 == 1) then jump label 6ifstr 4 6 "1"!! if no modem v42 link requested (var 4 == 0) [same as ARA 1.0] then jump label 9ifstr 4 9 "0"!! else invalid value in var 4; exit w/errorjump 86!!!@LABEL 5!--------------------------------! yes, mnp 10 link is requested.!--------------------------------matchclrmatchstr 1 7 "OK\13\10"! \N2 and \X0 - MNP 10.write "AT\13"matchread 300jump 81!!!@LABEL 6!------------------------------------------------------! yes, mnp link is requested.!------------------------------------------------------matchclrmatchstr 1 7 "OK\13\10"! \N2 - MNP autoreliable modewrite "AT\13"matchread 300jump 81!!!@LABEL 7!---------------------------------------------------------------! If we DID support compression in the modem, this is where it would go.!---------------------------------------------------------------!!!@LABEL 9!---------------------------------------------------------------! If speaker on flag is true, jump to label 13.  Else turn off the speaker.!---------------------------------------------------------------ifstr 2 13 "1"pause 5matchclrmatchstr 1 13 "OK\13\10"write "AT\13"matchread 30jump 81!*******************************************************! modem ready, so enable answering or originate a call - label range is 11-30!!!********************************************************@LABEL 13pause 5ifANSWER 72!! if normal dialing (parm 6 == 0) jump to 19ifstr 6 19 "0"!! if blind dialing (parm 6 == 1) jump to 17ifstr 6 17 "1"!! if manual dialing (parm 6 == 2) jump to 15 ifstr 6 15 "2"!! else invalid value in var 6; exit w/errorjump 86!!!@label 15note "手動ダイアル中。" 3! "Manual dialing initiated" 3! X1 to ignore dialtone & busy for manual dialing, D to dialwrite "ATX1D \13"jump 32!!!@label 17note "ダイアルトーンを無視してダイアル中。" 3! "Dialing without tone" 3matchclrmatchstr 1 19 "OK\13\10"! X3 to ignore dialtone for blind dialingwrite "ATX3\13"matchread 30jump 81!!!@label 19! this is where we break up long dialstrings!! parm 1 is always the full dialstring from the conn docnote "^1 をダイアル中。" 3! "Dialing ^1" 3! parm 3 is always "p" for pulse & "t" for tone!! if parm 8 == blank (complete dialstring in parm 7)!  then jump to label 27 & dial parm 7ifstr 8 27 " "!! if parm 9 == blank (complete dialstring in parms 7 & 8)!  then jump to label 24 & dial parm 7 & 8ifstr 9 24 " "!!  else dial parm 7 & 8 & 9 (complete dialstring in parms 7, 8 & 9)matchclrmatchstr 1 21 "OK\13\10"! parm 7 holds first string fragmentwrite "ATD^3^7;\13"matchread 400! modem not responding; bailout.jump 81!!!@label 21! parm 8 holds second string fragmentmatchclrmatchstr 1 22 "OK\13\10"write "ATD^3^8;\13"matchread 400! modem not responding; bailout.jump 81!!!@label 22! parm 9 holds last string fragmentwrite "ATD^3^9\13"jump 32!!!!@label 24matchclrmatchstr 1 25 "OK\13\10"! parm 7 holds first string fragmentwrite "ATD^3^7^8\13"!matchread 400! modem not responding; bailout.jump 32!!!@label 25! parm 8 holds last string fragmentwrite "ATD^3^8\13"jump 32!!!@label 27! parm 7 holds entire stringwrite "ATD^3^7\13"jump 32!***********************************************!    connecting - label range is 34-60!!!***********************************************@LABEL 32matchclr!matchstr 1  34 "CONNECT 2400\13\10"!matchstr 4  37 "CONNECT 4800\13\10"!matchstr 10 43 "CONNECT 9600\13\10"!matchstr 22 55 "CONNECT 19200\13\10"!matchstr 24 57 "CONNECT 32000\13\10"!matchstr 25 58 "CONNECT 38400\13\10"!matchstr 28 61 "CONNECT 57600\13\10"!matchstr 29 62 "CONNECT 64000\13\10"!!matchstr 31 64 "CONNECT 115200\13\10"matchstr 31 64 "CONNECT 115200\13"!matchstr 33 66 "CONNECT\13\10"!! other result codes.!matchstr 37 73 "RING\13\10"matchstr 38 82 "NO DIALTONE\13\10"matchstr 39 83 "NO CARRIER\13\10"matchstr 40 83 "ERROR\13\10"matchstr 41 84 "BUSY\13\10"matchstr 42 85 "NO ANSWER\13\10"matchstr 43 87 "CONNECT\13\10"!matchread 700ifANSWER 32jump 81!------------------------------------------------------------!!------------------------------------------------------------@LABEL 34note "2400 bps で接続中" 2! "Communicating at 2400 bps." 2CommunicatingAt 2400jump 70!!@LABEL 37note "4800 bps で接続中" 2! "Communicating at 4800 bps." 2CommunicatingAt 4800jump 70!!@LABEL 43note "9600 bps で接続中" 2! "Communicating at 9600 bps." 2CommunicatingAt 9600jump 70!!@LABEL 55note "19.2 kbps で接続中" 2! "Communicating at 19200 bps." 2CommunicatingAt 19200jump 70!!@LABEL 57note "32 kbps で接続中" 2! "Communicating at 32000 bps." 2CommunicatingAt 32000jump 70!!@LABEL 58note "38.4 kbps で接続中" 2! "Communicating at 38400 bps." 2CommunicatingAt 38400jump 70!!@LABEL 61note "57.6 kbps で接続中" 2! "Communicating at 57600 bps." 2CommunicatingAt 57600jump 70!!@LABEL 62note "64 kbps で接続中" 2! "Communicating at 64000 bps." 2CommunicatingAt 64000jump 70!!@LABEL 64note "115.2 kbps で接続中" 2! "Communicating at 115200 bps." 2CommunicatingAt 115200jump 70!!@LABEL 66note "接続中" 2! "Communicating" 2CommunicatingAt 115200jump 70!!@LABEL 70! turn on cts handshaking.HSReset 0 1 0 0 0 0!ifANSWER 71pause 30@LABEL 71exit 0!*******************************************************! @ANSWER! Set the modem to answer on 1st ring - label range is 72-80!!*******************************************************@LABEL 72matchclrmatchstr 1 32 "OK\13\10"write "ATS0=1\13"matchread 30jump 81!@LABEL 73ifORIGINATE 32! claim the serial portuserhook 1note "電話に応対しています。" 2! "Answering phone..." 2jump 32!************************************************! error messages - label range is 81-100!!!************************************************! Modem Not Responding@LABEL 81exit -6019!! No Dial Tone@LABEL 82exit -6020!! No Carrier or Error@LABEL 83exit -6021!! Busy@LABEL 84exit -6022!! No Answer@LABEL 85exit -6023!! varstring invalid value@LABEL 86exit -6027!! Connect 300bps@LABEL 87exit -6002 "ARA は 300bps の接続に対応していません。"! -6002 "ARA doesn't support 300bps connection."!!********************************************! Hang up the modem - label range is 101-120!!!********************************************@HANGUP@LABEL 102settries 0HSReset 0 0 0 0 0 0@LABEL 105!----------------------------! firstly try escape sequence!----------------------------matchclrmatchstr 1 108 "OK\13\10"pause 10write "+++"matchread 15!@LABEL 108!-------------------! secondly try ATH!-------------------matchclrmatchstr 1 111 "NO CARRIER\13\10"matchstr 2 111 "OK\13\10"matchstr 3 111 "ERROR\13\10"write "ATH\13"matchread 30inctriesiftries 3 81!---------------------------------------! finaly try On-to-Off DTR transitions!---------------------------------------DTRSetpause 5DTRClearpause 5DTRSetflushjump 105!------------------------------! recall the factory settings.!------------------------------@LABEL 111pause 15matchclrmatchstr 1 114 "OK\13\10"write "AT&F\13"matchread 30jump 81!@LABEL 114exit 0!*********************************************************! labels 121-128 are reserved for future emergency hacks!!!********************************************************